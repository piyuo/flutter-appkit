import 'package:libcli/pb/pb.dart' as pb;
import 'package:libcli/cache/cache.dart' as cache;
import 'data.txt';

class DataCommon<T extends pb.Object> {
  DataCommon({
    required this.dataBuilder,
    this.dataRemover,
  });

  /// DataBuilder build data
  final pb.Builder<T> dataBuilder;

  /// DataRemover remove data, return true if removal success
  final DataRemover<T>? dataRemover;

  /// hasDataRemover return true if there data remover is not null
  bool get hasDataRemover => dataRemover != null;

  /// set data to cache
  Future<void> setCacheDeleted(
    List<String> ids, {
    required pb.Builder builder,
  }) async {
    for (final id in ids) {
      final item = builder();
      item.setEntity(
        pb.Entity(
          id: id,
          updateTime: DateTime.now().utcTimestamp,
          deleted: true,
        ),
      );
      await cache.setObject(id, item);
    }
  }
}
