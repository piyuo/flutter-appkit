// ignore_for_file: invalid_use_of_visible_for_testing_member
import 'package:flutter_test/flutter_test.dart';
import 'helper.dart';
import 'database_provider.dart';
import 'base.txt';

void main() {
  setUpAll(() async {
    resetDatabaseUsage();
    await initForTest();
    await delete('test');
    await delete('test2');
  });

  tearDown(() async {
    await delete('test');
    await delete('test2');
  });

  group('[database_provider]', () {
    test('should keep track database usage', () async {
      final provide = DatabaseProvider(name: 'test');
      await provide.load();
      expect(provide.name, 'test');
      expect(databaseUsageCount, 1);

      final provide2 = DatabaseProvider(name: 'test');
      await provide2.load();
      expect(provide.name, 'test');
      expect(databaseUsageCount, 2);

      provide.dispose();
      expect(databaseUsageCount, 1);
      provide2.dispose();
      expect(databaseUsageCount, 0);
    });

    test('should reset when database name changed', () async {
      final provide = DatabaseProvider(name: 'test');
      await provide.load();
      expect(provide.name, 'test');
      expect(databaseUsageCount, 1);

      final provide2 = DatabaseProvider(name: 'test2');
      await provide2.load();
      expect(provide2.name, 'test2');
      expect(databaseUsageCount, 1);

      provide.dispose();
      expect(databaseUsageCount, 1);
      provide2.dispose();
      expect(databaseUsageCount, 0);
    });
  });
}
