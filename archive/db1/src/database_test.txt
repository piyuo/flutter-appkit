// ignore_for_file: invalid_use_of_visible_for_testing_member
import 'package:libcli/sample/sample.dart' as sample;
import 'package:flutter_test/flutter_test.dart';
import 'database.dart';
import 'db.dart';

void main() {
  setUpAll(() async {
    await initForTest();
    await deleteTestDb('test_db');
  });

  setUp(() async {});

  tearDownAll(() async {
    await deleteTestDb('test_db');
  });

  group('[database]', () {
    test('should set/get bool', () async {
      final database = Database();
      await database.open('test_db');
      await database.setBool('k', false);
      final value = database.getBool('k');
      expect(value, false);
    });

    test('should set/get int', () async {
      final database = Database();
      await database.open('test_db');
      await database.setInt('k', 1);
      final value = database.getInt('k');
      expect(value, 1);
    });

    test('should set/get string', () async {
      final database = Database();
      await database.open('test_db');
      await database.setString('k', 'hi');
      final value = database.getString('k');
      expect(value, 'hi');
    });

    test('should set/get datetime', () async {
      final database = Database();
      await database.open('test_db');
      final now = DateTime.now();
      await database.setDateTime('k', now);
      final value = database.getDateTime('k');
      expect(value, now);
    });

    test('should set/get pb.object', () async {
      final database = Database();
      await database.open('test_db');
      final person = sample.Person(name: 'l');
      await database.setObject('k', person);
      final value = database.getObject<sample.Person>('k', () => sample.Person());
      expect(value, isNotNull);
      expect(value!.name, 'l');
      expect(value, person);
    });

    test('should save string list', () async {
      final database = Database();
      await database.open('test_db');
      final list = <String>['1', '2', '3'];
      await database.setStringList('l', list);
      var list2 = database.getStringList('l');
      expect(list2!.length, 3);
      expect(list2[2], '3');
    });

    test('should save int list', () async {
      final database = Database();
      await database.open('test_db');
      final list = <int>[1, 2, 3];
      await database.setIntList('l', list);
      var list2 = database.getIntList('l');
      expect(list2!.length, 3);
      expect(list2[2], 3);
    });

    test('should reset', () async {
      final database = Database();
      await database.open('test_db');
      await database.setString('a', 'b');
      await database.setString('1', '2');
      await database.reset();
      expect(database.contains('a'), false);
      expect(database.contains('1'), false);
    });
  });
}
