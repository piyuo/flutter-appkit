import 'package:libcli/module.dart';
import 'package:libcli/i18n.dart';
import 'package:piyuo/src/dialog/message-dialog.txt';

class DialogNoInternetOptions {
  final Function(bool retry) onPressed;

  final String errorCode;

  DialogNoInternetOptions({
    required this.onPressed,
    required this.errorCode,
  });
}

class DialogNoInternetProvider extends AsyncProvider {}

class DialogNoInternet extends ViewWidget<DialogNoInternetProvider> {
  final DialogNoInternetOptions options;

  DialogNoInternet(this.options) : super(i18nFilename: 'dialog', package: 'libcli');

  @override
  createProvider(BuildContext context) => DialogNoInternetProvider();

  @override
  Widget createWidget(BuildContext context) => DialogNoInternetWidget(options);
}

class DialogNoInternetWidget extends StatelessWidget {
  final DialogNoInternetOptions options;

  DialogNoInternetWidget(this.options);

  void close(BuildContext context, bool retry) {
    Navigator.of(context)!.pop();
    options.onPressed(retry);
  }

  @override
  Widget build(BuildContext context) {
    return MessageDialog(
      color: Colors.deepOrange[700]!,
      icon: Icons.cloud_off,
      title: 'netTitle'.i18n(context),
      labelOK: 'retry'.i18n_,
      onOKPressed: () => close(context, true),
      labelCancel: 'close'.i18n_,
      onCancelPressed: () => close(context, false),
      message: 'netMsg'.i18n(context),
      notes: 'errCode'.i18n_ + options.errorCode,
    );
  }
}
